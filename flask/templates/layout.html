<!doctype html>
<html lang="da">
  <head>
    <meta charset="utf-8">
    <!-- OpenGraph -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://bobechgifs.dk/">
    <meta property="og:title" content="Bo Bech-GIFs">
    <meta property="og:description" content="Ekspressive GIFs med tv-kokken Bo Bech, der især er kendt fra tv-programmet Med kniven for struben">
    <meta property="og:image" content="{{ url_for('static', filename='favicon.ico') }}">

    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Ekspressive GIFs med tv-kokken Bo Bech, der især er kendt fra tv-programmet Med kniven for struben">
    <meta name="keywords" content="GIF, GIFs, Bo Bech, Med kniven for struben">

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.0/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-KyZXEAg3QhqLMpG8r+8fhAXLRk2vvoC2f3B09zVXn8CA5QIVfZOJ3BCsw2P0p/We" crossorigin="anonymous">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <title>Bo Bech-GIFs</title>
    <link rel="shortcut icon" href="{{ url_for('static', filename='favicon.ico') }}">
  </head>
  <body>
    <div class="container">
        {% block content %}{% endblock %}
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.0/dist/js/bootstrap.bundle.min.js" integrity="sha384-U1DAWAznBHeqEIlVSCgzq+c9gqGAJn5c/t99JyeKa9xxaYpSvHU5awsuZVVFIhvj" crossorigin="anonymous"></script>
 
    <!-- Toggle plugin for bootstrap -->
    <link href="https://cdn.jsdelivr.net/gh/gitbrent/bootstrap4-toggle@3.6.1/css/bootstrap4-toggle.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/gh/gitbrent/bootstrap4-toggle@3.6.1/js/bootstrap4-toggle.min.js"></script>

    <link href="static/styles.css" rel="stylesheet">

    <script>
      const load_button = document.querySelector('#load-button');
      var current_mood;
      var gifs_current = 0;
      let gifs_increment = 12;
      var show_text_gifs = true;

      function GifClickFunction(gif_link) {
        navigator.clipboard.writeText(gif_link); 
        $( "#alert-popup" ).stop(true, false).fadeIn( 300 ).delay( 1500 ).fadeOut( 400 );
      };

      // GIFs are shown or hidden by setting the display class 
      // based on whether each GIF illustrates the specified mood
      $(document).ready(function() {
        $(".mood-button").click(function() {
          current_mood = this.id;
          clear_gifs();
          refresh_gifs(gifs_to_load=gifs_increment);
        });

        $("#textToggler").change(function() {
          show_text_gifs = !show_text_gifs;
          clear_gifs();
          refresh_gifs(gifs_to_load=gifs_increment);
        });
        $("#textToggler").prop('checked', true).change();


        $("#load-button").click(function() {
          refresh_gifs(gifs_to_load=gifs_increment);
        });

        current_mood = 'All';
        $(".mood-button").filter(`[id=${current_mood}]`).trigger("click");
      });

      function set_visibility(item, visible=True, class_visible='d-flex', class_invisible='d-none') {
        if (visible) {
          item.addClass(class_visible);
          item.removeClass(class_invisible);
        } else {
          item.addClass(class_invisible);
          item.removeClass(class_visible);
        }
      }

      function clear_gifs() {
        $('.gif').each(function(i, obj) {
          set_visibility($(obj).parent(), visible=false);
        });
      };

      function refresh_gifs(gifs_to_load) {
        still_gifs_to_load = false;
        gifs_loaded = 0;
        $('.gif').each(function(i, obj) {
              moods = $(obj).attr("data-moods")
              has_text = $(obj).attr("data-hasText")
              // Always show gifs with no text
              // Only show gifs with text if this has been set
              let show_gif = has_text == 0 || !(has_text == 1 && !show_text_gifs);
              let visible = ($(obj).parent().hasClass("d-flex"))
              let displays_mood = moods.indexOf(current_mood) >= 0;
              
              if (!visible && displays_mood && gifs_loaded < gifs_to_load && show_gif) {
                set_visibility($(obj).parent(), visible=true)
                gifs_loaded++;
              } else if (!displays_mood || !show_gif) {
                set_visibility($(obj).parent(), visible=false)
              }

              if (displays_mood && show_gif && gifs_loaded == gifs_to_load) {
                set_visibility($(load_button), visible=true, class_visible='d-inline');
                return false; // break
              } else {
                set_visibility($(load_button), visible=false, class_visible='d-inline');
              }
          });
      };
    </script>
  </body>
</html>
