<!doctype html>
<html lang="da">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Ekspressive GIFs med Bo Bech">
    <meta name="keywords" content="GIF, GIFs, Bo Bech, Med kniven for struben">

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.0/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-KyZXEAg3QhqLMpG8r+8fhAXLRk2vvoC2f3B09zVXn8CA5QIVfZOJ3BCsw2P0p/We" crossorigin="anonymous">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <title>Bo Bech GIFs</title>
    <link rel="shortcut icon" href="{{ url_for('static', filename='favicon.ico') }}">
  </head>
  <body>
    <div class="container">
        {% block content %}{% endblock %}
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.0/dist/js/bootstrap.bundle.min.js" integrity="sha384-U1DAWAznBHeqEIlVSCgzq+c9gqGAJn5c/t99JyeKa9xxaYpSvHU5awsuZVVFIhvj" crossorigin="anonymous"></script>
 
    <link href="static/styles.css" rel="stylesheet">

    <script>
      var current_mood = 'All';
      var currentItems = 12;
      var increment = 12;
      var checkedItems = 0;

      function GifClickFunction(gif_link) {
        navigator.clipboard.writeText(gif_link); 
        $( "#alert-popup" ).stop(true, false).fadeIn( 300 ).delay( 1500 ).fadeOut( 400 );
      }

      // GIFs are shown or hidden by setting the display class 
      // based on whether each GIF illustrates the specified mood
      $(document).ready(function() { 
        $(".mood-button").click(function() {
          current_mood = this.id;
          index = 0;
          $('.gif').each(function(_, obj) {
            moods = $(obj).attr("data-moods")
            if (moods.indexOf(current_mood) >= 0 && index < 12) {
              $(obj).parent().addClass("d-flex");
              $(obj).parent().removeClass("d-none");
              index++
            } else {
              $(obj).parent().addClass("d-none");
              $(obj).parent().removeClass("d-flex");
            }
          });
        });
      });

      $(document).ready(function() { 
        $("#All").trigger("click");
        $("#All").trigger("focus");
      });

      // Adapted from https://www.markuptag.com/javascript-load-more-content-on-click-button/
      const loadmore = document.querySelector('#loadmore');
      loadmore.addEventListener('click', (e) => {
          const elementList = [...document.querySelectorAll('.gif')];
          var index = currentItems;
          while (index < (currentItems + increment) && checkedItems < elementList.length) {
              if (elementList[index]) {
                if (elementList[index].getAttribute("data-moods").match(current_mood)) { // TODO: Is match() the right approach? There's also includes()
                  elementList[index].parentElement.classList.add("d-flex");
                  elementList[index].parentElement.classList.remove("d-none");
                }
                index++;
              }
              checkedItems++;
          }
          if (checkedItems >= elementList.length) {
            event.target.style.display = 'none';
          }
          currentItems = index;
      })
    </script>
  </body>
</html>
